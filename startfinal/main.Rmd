---
title: "Main"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(httr2)
library(plotly)
library(DT)
library(httr)
library(stringr)
```

# Graph that will include a dropdown menu for the user to select an artist. It will display the artist's top tracks and if the track is explicit or not.
```{r}
# Example: Pick an artist
selected_artist <- "Drake"

# Filter tracks for the selected artist
artist_top_tracks <- combined_tracks |>
  filter(artist_name == selected_artist) |>
  distinct(track_name, .keep_all = TRUE)

# Create ggplot with custom text for tooltip
artist_tracks_plot <- ggplot(
  artist_top_tracks,
  aes(
    x = fct_reorder(track_name, popularity),
    y = popularity,
    fill = ifelse(explicit, "Explicit", "Non-Explicit"),
    text = str_c(
      "Track: ", track_name, "\n",
      "Popularity: ", popularity, "\n",
      "Explicit: ", ifelse(explicit, "Yes", "No")
    )
  )
) +
  scale_fill_manual(
    values = c("Explicit" = "#1db954", "Non-Explicit" = "#191414")
  ) +
  geom_col(show.legend = TRUE) +
  theme_minimal() +
  labs(
    title = paste("Top Tracks by", selected_artist),
    x = "Track Name",
    y = "Popularity",
    fill = "Track Type"
  ) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

# Convert to Plotly
ggplotly(artist_tracks_plot, tooltip = "text")
```


```{r}
# Example: Pick an artist
selected_artist <- "Taylor Swift"

# Filter unique tracks for the selected artist
top_tracks_duration <- combined_tracks |>
  filter(artist_name == selected_artist) |>
  distinct(track_name, .keep_all = TRUE) |>
  mutate(duration_min = track_duration_ms / 60000)

# Plot of popularity vs duration for the selected artist
top_tracks_duration_plot <- ggplot(
  top_tracks_duration,
  aes(
    x = duration_min,
    y = popularity,
    text = str_c(
      "Track: ", track_name, "\n",
      "Duration: ", round(duration_min, 2), " min\n",
      "Popularity: ", popularity, "\n"
    )
  )
) +
  geom_point(color = "#1db954", size = 4, alpha = 0.8) +
  theme_minimal() +
  labs(
    title = paste("Popularity vs Duration for", selected_artist),
    x = "Duration (minutes)",
    y = "Popularity"
  )

# Convert to Plotly
ggplotly(top_tracks_duration_plot, tooltip = "text")
```


## Resources:
1. Revealed: The Top Artists, Songs, Albums, Podcasts, and Audiobooks of 2024 (https://newsroom.spotify.com/2024-12-04/top-songs-artists-podcasts-audiobooks-albums-trends-2024/)

2. Spotify Web API
(https://developer.spotify.com/documentation/web-api)
